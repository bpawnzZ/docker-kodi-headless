#!/usr/bin/with-contenv bash

# Create Wayland runtime directory
mkdir -p /tmp
chown abc:abc /tmp

# Ensure proper permissions for GPU devices
if [ -e /dev/dri ]; then
    chown -R abc:abc /dev/dri
fi

# Set up environment for Wayland
export XDG_RUNTIME_DIR=/tmp
export WAYLAND_DISPLAY=wayland-0
export DISPLAY=:0

# Log GPU information
if [ -e /dev/dri ]; then
    echo "GPU devices detected:"
    ls -la /dev/dri/
fi

# Check for VAAPI support
if command -v vainfo >/dev/null 2>&1; then
    echo "Checking VAAPI support:"
    s6-setuidgid abc vainfo 2>/dev/null || echo "VAAPI not available"
fi